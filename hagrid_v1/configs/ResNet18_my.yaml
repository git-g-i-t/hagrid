# ==========================================
# ResNet18 配置文件详解
# 任务类型：图像分类 (Image Classification)
# 适用脚本：demo_ff.py (全帧分类)
# ==========================================
#Exp params

# ---------- 1. 实验控制参数 ----------
epochs: 100         # 训练总轮数
log_every: 9      # 每迭代 9 个 batch 打印一次日志
eval_every: 1       # 每 1 个 epoch 在验证集上评估一次
test_every: 0       # 0 表示训练期间不跑测试集（通常只在训练结束后跑）
experiment_name: ResNet18 # 实验名称，决定日志和模型保存文件夹的名字
work_dir: hagrid_v1\work_dir  # 输出目录

# ---------- 2. 早停策略 ---------------
early_stopping:
    epochs: 10      # 耐心值：如果验证集指标连续 10 个 epoch 不涨，就停止训练
    metric: 0.01    # 最小提升阈值


# --- 3. 数据集配置 ---
# Dataset configuration   1.0
dataset:
    annotations_train: "annotations_mini/train"
    annotations_val: "annotations_mini/val" 
    annotations_test: "annotations_mini/test"

    dataset_train: "dataset_mini/train"
    dataset_val: "dataset_mini/val"
    dataset_test: "dataset_mini/test"

    
    # 图像参数
    img_size: &img_size 224     # Image size for training, must be square
    # ImageNet 数据集的统计均值和方差
    # 这里的定义会被下面的 Normalize 引用
    img_mean: &img_mean [0.54, 0.499, 0.474]
    img_std: &img_std [0.234, 0.235, 0.231]

    subset: -1 # 使用全部数据

    one_class: False  # False = 多分类（区分具体手势）；True = 二分类（只区分是不是手）

    # 分类类别列表
    targets:
        - call
        - ok
        - like
        - stop
        - three
        - holy
        - hand_heart

# --- 4. 预处理与增强管道 ---
# Transform and augmentation pipeline. See https://albumentations.ai/docs/ for using
# 相比检测模型，分类模型这里显式增加了 Normalize
train_transforms:
    # 1. 保持长宽比缩放：长边缩放到 224
    LongestMaxSize:
        max_size: *img_size
        p: 1
    # 2. 填充：短边填充灰色背景，凑成 224x224 正方形
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    # 3. 归一化 (关键步骤)
    # 将像素值从 [0, 255] 转换并标准化到均值为0、方差为1的分布
    # 这是 ResNet 等 CNN 网络收敛的必要条件
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# 验证集预处理 (同训练集)
val_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# 测试集预处理 (同验证集)
test_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# --- 5. 模型参数 ---
model:
    name: ResNet18               # 模型名称
    pretrained: False           # 是否加载 ImageNet 预训练权重
    pretrained_backbone: False
    checkpoint: null

# --- 6. 优化器 ---
optimizer:
    name: SGD
    params:
        lr: 0.01           # 初始学习率 (分类任务通常比检测任务略高)
        weight_decay: 0.0001 # L2 正则化，防止过拟合
        momentum: 0.9      # 动量

# --- 7. 学习率调度器 (Scheduler) ---
# 这里与 SSDLite 不同，启用了 ReduceLROnPlateau
scheduler:
    name: ReduceLROnPlateau
    params:
        mode: min   # 监测模式：当监测指标(通常是 loss) 不再下降(min)时触发
        factor: 0.1 # 触发后，将学习率乘以 0.1 (即缩小10倍)

# --- 8. 损失函数 (Criterion) ---
# 这是分类任务的标准损失函数
# 结合了 LogSoftmax 和 NLLLoss
criterion: CrossEntropyLoss

# --- 9. 数据加载参数 ---
train_params:
    num_workers: 2    # 线程数
    shuffle: True      # 训练必须打乱
    batch_size: 32    # 批大小
    prefetch_factor: 3 # 预读取数量

# 同上
test_params:
    num_workers: 2
    shuffle: False
    batch_size: 32
    prefetch_factor: 3

val_params:
    num_workers: 2
    shuffle: True
    batch_size: 32
    prefetch_factor: 3
