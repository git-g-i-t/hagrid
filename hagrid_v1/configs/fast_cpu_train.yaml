# =================================================================
# 极速 CPU 训练配置 (目标：<30分钟) 1.0新加
# 核心策略：换用轻量级模型 + 极小图片尺寸 + 极少数据量
# =================================================================

# 实验参数
epochs: 10          # ⚠️ CPU 跑 50 轮太慢了，先跑 10 轮验证代码流程
log_every: 10       # 频繁一点看日志，确保没卡死
eval_every: 1       # 每个 epoch 都验证，因为 epoch 很少
test_every: 0
experiment_name: Fast_CPU_Run
work_dir: work_dir

# 早停设置
early_stopping:
    epochs: 3       # 既然只有 10 轮，耐心值设小一点
    metric: 0.01

# 数据集配置
dataset:
    # 请确保这些路径下是你那个“只留了7个手势”的 mini 数据集
    annotations_train: "annotations_mini/train"
    annotations_val: "annotations_mini/val" 
    annotations_test: "annotations_mini/test"

    dataset_train: "dataset_mini/train"
    dataset_val: "dataset_mini/val"
    dataset_test: "dataset_mini/test"

    img_size: &img_size 64       # ⚠️ 极速模式：从 128 降到 64。CPU 狂喜。
    img_mean: &img_mean [0.54, 0.499, 0.474]
    img_std: &img_std [0.234, 0.235, 0.231]
    
    # ⚠️ 限制数据量：如果你的 mini 数据集图片很多，这里强制只取前 200 张
    # 如果你的图片本身就少于 200 张，这个参数会被自动忽略
    subset: 200  

    one_class: False

    # ⚠️⚠️⚠️ 必须修改：这里必须只保留你留下的那 7 个文件夹的名字
    # 请根据你实际保留的文件夹修改下面的列表！不要留不存在的类别！
    targets:
        - hand_heart
        - middle_finger
        - dislike
        - like
        - one
        - stop
        - stop_inverted
        - no_gesture

# 训练数据增强
train_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# 验证集数据变换
val_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# 测试集数据变换
test_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# 模型参数配置
model:
    # ⚠️⚠️⚠️ 核心修改：换用 MobileNetV3_small
    # ConvNeXt_base 在 CPU 上跑完可能需要 5 个小时，MobileNet 只要 20 分钟
    name: MobileNetV3_small
    pretrained: False  # 不加载预训练权重，纯从头跑（因为你改了类别数，加载也容易报错）
    pretrained_backbone: False
    checkpoint: null

# 优化器配置
optimizer:
    name: AdamW
    params:
        lr: 0.001
        weight_decay: 0.05
        eps: 0.00000001

# 学习率调度器
scheduler:
    name: StepLR
    params:
        step_size: 5  # 配合 epochs: 10，每 5 轮降一次
        gamma: 0.5

criterion: CrossEntropyLoss

# 训练参数
train_params:
    # ⚠️ CPU 训练建议设为 0 (主线程加载) 或 2。设太大反而因为进程切换变慢。
    num_workers: 0    
    shuffle: True
    batch_size: 32    # MobileNet 很小，CPU 也可以尝试 32 或 16
    prefetch_factor: null

test_params:
    num_workers: 0
    shuffle: False
    batch_size: 32
    prefetch_factor: null

val_params:
    num_workers: 0
    shuffle: True
    batch_size: 32
    prefetch_factor: null