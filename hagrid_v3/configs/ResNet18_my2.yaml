# ==========================================
# ResNet18 ç¬¬äºŒç‰ˆï¼šé«˜æ€§èƒ½ä¼˜åŒ–é…ç½®
# ç‰¹æ€§ï¼šå¼ºæ•°æ®å¢žå¼º + é¢„è®­ç»ƒ + AdamW
# ==========================================

# ---------- 1. å®žéªŒæŽ§åˆ¶å‚æ•° ----------
epochs: 100
log_every: 50       # å»ºè®®ç¨å¾®é¢‘ç¹ä¸€ç‚¹ï¼Œæ–¹ä¾¿è§‚å¯Ÿ
eval_every: 1
test_every: 0
experiment_name: ResNet18
work_dir: hagrid_v2/work_dir

# ---------- 2. æ—©åœç­–ç•¥ ---------------
early_stopping:
    epochs: 15      # å¢žå¼ºåŽæ¨¡åž‹æ”¶æ•›æ³¢åŠ¨å¤§ï¼Œè€å¿ƒå€¼ç»™å¤§ä¸€ç‚¹
    metric: 0.01

# --- 3. æ•°æ®é›†é…ç½® ---
dataset:
    annotations_train: "annotations_mini/train"
    annotations_val: "annotations_mini/val"
    annotations_test: "annotations_mini/test"

    dataset_train: "dataset_mini/train"
    dataset_val: "dataset_mini/val"
    dataset_test: "dataset_mini/test"

    img_size: &img_size 224
    img_mean: &img_mean [0.54, 0.499, 0.474]
    img_std: &img_std [0.234, 0.235, 0.231]

    subset: -1
    one_class: False

    # ä½ çš„ 8 ä¸ªç±»åˆ«
    targets:
        - call
        - ok
        - like
        - stop
        - three
        - holy
        - hand_heart

# --- 4. é¢„å¤„ç†ä¸Žå¢žå¼ºç®¡é“ (ðŸ”¥ é‡ç‚¹ä¿®æ”¹åŒºåŸŸ) ---
train_transforms:
    # 1. å‡ ä½•å˜æ¢ï¼šæ¨¡æ‹Ÿå„ç§æ‰‹åŠ¿è§’åº¦å’Œä½ç½®
    HorizontalFlip:
        p: 0.5  # 50% æ¦‚çŽ‡å·¦å³ç¿»è½¬
    
    ShiftScaleRotate:
        shift_limit: 0.1    # å¹³ç§»
        scale_limit: 0.1    # ç¼©æ”¾
        rotate_limit: 20    # æ—‹è½¬ +/- 20åº¦
        border_mode: 0      # è¾¹ç•Œå¡«é»‘
        value: [144,144,144]
        p: 0.5

    # 2. åƒç´ å˜æ¢ï¼šæ¨¡æ‹Ÿä¸åŒç”»è´¨å’Œå…‰ç…§
    RandomBrightnessContrast:
        p: 0.3  # è°ƒæ•´äº®åº¦å¯¹æ¯”åº¦
        
    RGBShift:
        r_shift_limit: 20
        g_shift_limit: 20
        b_shift_limit: 20
        p: 0.3  # è°ƒæ•´è‰²è°ƒ

    GaussNoise:
        var_limit: [10.0, 50.0]
        p: 0.2  # å¢žåŠ å™ªç‚¹

    MotionBlur:
        blur_limit: 5
        p: 0.2  # å¢žåŠ è¿åŠ¨æ¨¡ç³Š

    # 3. åŸºç¡€å¤„ç† (å¿…é¡»ä¿ç•™åœ¨æœ€åŽ)
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# éªŒè¯é›†ä¿æŒå¹²å‡€ (ä¸è¦æ”¹åŠ¨)
val_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# æµ‹è¯•é›†ä¿æŒå¹²å‡€
test_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# --- 5. æ¨¡åž‹å‚æ•° ---
model:
    name: ResNet18
    pretrained: False         # ðŸ”¥ å¿…é¡»æ”¹ä¸º Trueï¼Œå¦åˆ™å¼ºå¢žå¼ºä¸‹å¾ˆéš¾æ”¶æ•›
    pretrained_backbone: True
    checkpoint: null        # ðŸ”¥ æ–°çš„è®­ç»ƒå»ºè®®è®¾ä¸º nullï¼Œä»Žå¤´å¼€å§‹è·‘é¢„è®­ç»ƒ

# --- 6. ä¼˜åŒ–å™¨ (ðŸ”¥ å»ºè®®ä¿®æ”¹) ---
optimizer:
    name: AdamW              # ðŸ”¥ æ¢ç”¨ AdamWï¼Œæ¯” SGD æ›´é€‚åˆå¤„ç†å¤æ‚å¢žå¼º
    params:
        lr: 0.0005           # å­¦ä¹ çŽ‡ç»™å°ä¸€ç‚¹ (0.001 -> 0.0005)
        weight_decay: 0.01   # å¢žåŠ æƒé‡è¡°å‡ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ

# --- 7. è°ƒåº¦å™¨ ---
scheduler:
    name: ReduceLROnPlateau
    params:
        mode: min
        factor: 0.1
        patience: 5

# --- 8. æŸå¤±å‡½æ•° ---
criterion: CrossEntropyLoss

# --- 9. æ•°æ®åŠ è½½å‚æ•° (é’ˆå¯¹ GPU ä¼˜åŒ–) ---
train_params:
    num_workers: 4      # ðŸ”¥ å¦‚æžœæ˜¯ GPUï¼Œå°è¯•å¼€åˆ° 4 (Windowsè‹¥æŠ¥é”™åˆ™æ”¹å›ž0)
    shuffle: True
    batch_size: 64      # ðŸ”¥ æ˜¾å­˜å…è®¸çš„è¯ï¼Œå¼€å¤§ä¸€ç‚¹ (32 -> 64)
    prefetch_factor: 2  # é…åˆ num_workers > 0

test_params:
    num_workers: 4
    shuffle: False
    batch_size: 64
    prefetch_factor: 2

val_params:
    num_workers: 4
    shuffle: True       # ðŸ”¥ å¿…é¡»ä¸º True
    batch_size: 64
    prefetch_factor: 2