# ==========================================
# MLP-1-Layer 配置文件
# 用于复现 Search_1-Layer_(Hidden_512) 实验
# ==========================================

epochs: 100
log_every: 9
eval_every: 1
test_every: 0
experiment_name: Search_1-Layer_(Hidden_512)
work_dir: hagrid_v2/work_dir

early_stopping:
    epochs: 15
    metric: 0.01

dataset:
    annotations_train: "hagrid_v2/annotations_mini/train"
    annotations_val: "hagrid_v2/annotations_mini/val"
    annotations_test: "hagrid_v2/annotations_mini/test"
    dataset_train: "hagrid_v2/dataset_mini/train"
    dataset_val: "hagrid_v2/dataset_mini/val"
    dataset_test: "hagrid_v2/dataset_mini/test"
    img_size: &img_size 224
    img_mean: &img_mean [0.54, 0.499, 0.474]
    img_std: &img_std [0.234, 0.235, 0.231]
    subset: -1
    one_class: False
    targets:
        - call
        - ok
        - like
        - stop
        - three
        - holy
        - hand_heart

train_transforms:
    HorizontalFlip:
        p: 0.5
    ShiftScaleRotate:
        shift_limit: 0.1
        scale_limit: 0.1
        rotate_limit: 20
        border_mode: 0
        value: [144,144,144]
         
        p: 0.5
    RandomBrightnessContrast:
        p: 0.3
    GaussNoise:
        var_limit: [10.0, 50.0]
        p: 0.2
    LongestMaxSize:      
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: 0
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

val_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

test_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

model:
    name: SE_ResNet18        # MLP 实验使用的是 SE_ResNet18 结构 (代码中动态修改了 head)
    pretrained: False
    pretrained_backbone: False
    checkpoint: "hagrid_v2/work_dir/Search_1-Layer_(Hidden_512)/SE_ResNet18_epoch-20_F1Score-0.83_loss-1.2.pth"

optimizer:
    name: AdamW
    params:
        lr: 0.001
        weight_decay: 0.01

scheduler:
    name: ReduceLROnPlateau
    params:
        mode: min
        factor: 0.5
        patience: 5

criterion: CrossEntropyLoss

train_params:
    num_workers: 0
    shuffle: True
    batch_size: 64
    prefetch_factor: null

test_params:
    num_workers: 0
    shuffle: False
    batch_size: 64
    prefetch_factor: null

val_params:
    num_workers: 0
    shuffle: True
    batch_size: 64
    prefetch_factor: null
