# ==========================================
# SE-ResNet18 é…ç½®æ–‡ä»¶
# åŸºäºï¼šResNet18 ä¼˜åŒ–ç‰ˆé…ç½®
# åŒºåˆ«ï¼šæ›´æ¢äº†å¸¦æœ‰æ³¨æ„åŠ›æœºåˆ¶çš„æ¨¡å‹ï¼Œå…³é—­äº†é¢„è®­ç»ƒ
# ==========================================

# ---------- 1. å®éªŒæ§åˆ¶å‚æ•° ----------
epochs: 100         # âš ï¸ ä»å¤´è®­ç»ƒ(False)æ¯”å¾®è°ƒ(True)éœ€è¦æ›´å¤šè½®æ¬¡ï¼Œè®¾ä¸º 100
log_every: 9
eval_every: 1
test_every: 0
experiment_name: SE_ResNet18_Attention
work_dir: hagrid_v2/work_dir

# ---------- 2. æ—©åœç­–ç•¥ ---------------
early_stopping:
    epochs: 15
    metric: 0.01

# --- 3. æ•°æ®é›†é…ç½® (ä¿æŒä¸å˜) ---
dataset:
    annotations_train: "hagrid_v2/annotations_mini/train"
    annotations_val: "hagrid_v2/annotations_mini/val"
    annotations_test: "hagrid_v2/annotations_mini/test"

    dataset_train: "hagrid_v2/dataset_mini/train"
    dataset_val: "hagrid_v2/dataset_mini/val"
    dataset_test: "hagrid_v2/dataset_mini/test"

    # SE-Block å¯¹åˆ†è¾¨ç‡ä¸æ•æ„Ÿï¼Œ128 æˆ– 224 éƒ½å¯ä»¥
    # ä¸ºäº† CPU/GPU éƒ½èƒ½è·‘å¿«ç‚¹ï¼Œå¯ä»¥ç”¨ 128ï¼›è¿½æ±‚ç²¾åº¦ç”¨ 224
    img_size: &img_size 224  
    
    img_mean: &img_mean [0.54, 0.499, 0.474]
    img_std: &img_std [0.234, 0.235, 0.231]

    subset: -1
    one_class: False

    # ä½ çš„ 7 ä¸ªç±»åˆ«
    targets:
        - call
        - ok
        - like
        - stop
        - three
        - holy
        - hand_heart

# --- 4. é¢„å¤„ç†ä¸å¢å¼ºç®¡é“ (ä¿æŒå¼ºå¢å¼º) ---
# æ³¨æ„åŠ›æœºåˆ¶æ“…é•¿å¤„ç†å¤æ‚èƒŒæ™¯ï¼Œæ‰€ä»¥å¼ºå¢å¼º(å™ªå£°/æ—‹è½¬)å¯¹å®ƒå¾ˆæœ‰åˆ©
train_transforms:
    #  1. å‡ ä½•å˜æ¢ï¼šæ¨¡æ‹Ÿå„ç§æ‰‹åŠ¿è§’åº¦å’Œä½ç½®
    HorizontalFlip:
        p: 0.5   # 50%æ¦‚ç‡ç¿»è½¬
    
    ShiftScaleRotate:
        shift_limit: 0.1   #å¹³ç§»
        scale_limit: 0.1   #ç¼©æ”¾
        rotate_limit: 20   #æ—‹è½¬ +-20åº¦
        border_mode: 0     #è¾¹ç•Œå¡«é»‘
        value: [144,144,144]
        p: 0.5

    # 2. åƒç´ å˜æ¢ï¼šæ¨¡æ‹Ÿä¸åŒç”»è´¨å’Œå…‰ç…§
    RandomBrightnessContrast:
        p: 0.3
        
    GaussNoise:
        var_limit: [10.0, 50.0]
        p: 0.2

    # 3. åŸºç¡€å¤„ç†
    LongestMaxSize:      
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

val_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

test_transforms:
    LongestMaxSize:
        max_size: *img_size
        p: 1
    PadIfNeeded:
        min_height: *img_size
        min_width: *img_size
        value: [144,144,144]
        border_mode: 0
        p: 1
    Normalize:
        mean: *img_mean
        std: *img_std
        max_pixel_value: 255.0
        p: 1

# --- 5. æ¨¡å‹å‚æ•° (ğŸ”¥ å…³é”®ä¿®æ”¹) ---
model:
    name: SE_ResNet18        # âœ… æ”¹æˆä½ æ³¨å†Œçš„æ–°åå­—
    pretrained: False        # âœ… å¿…é¡»ä¸º False (ç»“æ„å˜äº†ï¼Œå®˜æ–¹æƒé‡ä¸åŒ¹é…)
    pretrained_backbone: False
    checkpoint: hagrid_v2\work_dir\SE_ResNet18_Attention\SE_ResNet18_epoch-20_F1Score-0.83_loss-0.79.pth
# --- 6. ä¼˜åŒ–å™¨ (ä¿æŒ AdamW) ---
optimizer:
    name: AdamW
    params:
        lr: 0.001            # ä»å¤´è®­ç»ƒï¼Œå­¦ä¹ ç‡ä¿æŒ 0.001 æ¯”è¾ƒåˆé€‚
        weight_decay: 0.01

# --- 7. è°ƒåº¦å™¨ ---
scheduler:
    name: ReduceLROnPlateau
    params:
        mode: min
        factor: 0.5
        patience: 5

criterion: CrossEntropyLoss

# --- 8. æ•°æ®åŠ è½½å‚æ•° ---
train_params:
    num_workers: 0           # Windows å®‰å…¨è®¾ç½®
    shuffle: True
    batch_size: 64
    prefetch_factor: null

test_params:
    num_workers: 0
    shuffle: False
    batch_size: 64
    prefetch_factor: null

val_params:
    num_workers: 0
    shuffle: True
    batch_size: 64
    prefetch_factor: null